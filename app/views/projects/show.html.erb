<%# app/views/projects/show.html.erb %>
<% landing  = @project.active_landing %>
<% template = landing&.template || LandingTemplate.find(landing&.template_key) %>

<% active_tab = params[:tab].presence || "preview" %>
<% if active_tab == "preview" %>
  <% content_for :full_bleed, true %>
  <% content_for :no_main_padding, true %>
<% end %>

<!-- Project subnav -->
<div id="project-subnav" class="sticky top-[56px] z-30 bg-white/90 backdrop-blur border-b border-gray-200">
  <div class="max-w-6xl mx-auto px-4">
    <div class="flex items-center justify-between h-12">
      <div class="flex items-center gap-2 text-sm">
        <%= link_to "MVPScaler", dashboard_path, class: "text-gray-500 hover:text-gray-700" %>
        <span class="text-gray-300">›</span>
        <%= link_to "Projects", projects_path, class: "text-gray-500 hover:text-gray-700" %>
        <span class="text-gray-300">›</span>
        <span class="text-gray-900 font-medium"><%= @project.name %></span>
      </div>

      <nav class="flex items-center gap-2 text-sm">
        <%= link_to "Preview",
                    project_path(@project, tab: "preview"),
                    class: "px-3 py-1.5 #{active_tab=='preview' ? 'bg-gray-900 text-white' : 'text-gray-700 hover:bg-gray-100'}" %>
        <%= link_to "Overview",
                    project_path(@project, tab: "overview"),
                    class: "px-3 py-1.5 #{active_tab=='overview' ? 'bg-gray-900 text-white' : 'text-gray-700 hover:bg-gray-100'}" %>
        <%= link_to "Leads",
                    project_path(@project, tab: "leads"),
                    class: "px-3 py-1.5 #{active_tab=='leads' ? 'bg-gray-900 text-white' : 'text-gray-700 hover:bg-gray-100'}" %>
      </nav>
    </div>
  </div>
</div>

<% if active_tab == "preview" %>
  <!-- Preview: sidebar editor + live preview -->
  <div class="w-full">
    <div class="flex" data-controller="preview">

      <!-- LEFT: Editor sidebar -->
      <aside class="w-[360px] shrink-0">
        <div class="sticky top-[calc(56px+48px)]" style="height: var(--preview-height);">
          <div class="h-full overflow-y-auto border border-gray-200 bg-white">
            <div class="px-4 py-3 border-b border-gray-100 flex items-center justify-between">
              <h3 class="text-sm font-semibold text-gray-900">Template editor</h3>
              <span class="text-xs text-gray-500"><%= template&.name %></span>
            </div>

            <div class="p-4">
              <%= render "landing/edit_panel",
                         project:  @project,
                         landing:  landing,
                         template: template %>
            </div>
          </div>
        </div>
      </aside>

      <!-- RIGHT: Preview area (overlay controls) -->
      <section class="flex-1 min-w-0">
        <div class="relative w-full" style="height: var(--preview-height);">
          <!-- Overlay controls (top-right, minimal tab strip) -->
          <div class="absolute top-3 right-3 z-20 flex items-center gap-3 pointer-events-auto select-none">
            <button
              type="button"
              data-preview-target="desktopBtn"
              data-action="click->preview#toDesktop"
              aria-pressed="true"
              class="px-3 py-1.5 text-xs font-semibold tracking-wide
           border-b-2 border-emerald-600 text-emerald-700
           hover:text-emerald-700 transition">
              <i class="bi bi-display mr-1"></i>
              Desktop
            </button>

            <button
              type="button"
              data-preview-target="mobileBtn"
              data-action="click->preview#toMobile"
              aria-pressed="false"
              class="px-3 py-1.5 text-xs font-semibold tracking-wide
           border-b-2 border-transparent text-gray-700
           hover:border-gray-300 hover:text-gray-900 transition">
              <i class="bi bi-phone mr-1"></i>
              Mobile
            </button>

            <span class="text-gray-300">|</span>

            <%= link_to landing_show_path(@project.slug),
                        target: "_blank", rel: "noopener",
                        class: "px-3 py-1.5 text-xs font-semibold tracking-wide
                      border-b-2 border-transparent text-gray-700
                      hover:border-gray-300 hover:text-gray-900 transition" do %>
              <i class="bi bi-box-arrow-up-right mr-1"></i>
              Open
            <% end %>
          </div>

          <!-- DESKTOP -->
          <div data-preview-target="desktopWrap" class="absolute inset-0 overflow-hidden">
            <iframe src="<%= landing_show_path(@project.slug) %>"
                    class="w-full h-full"></iframe>
          </div>

          <!-- MOBILE -->
          <div data-preview-target="mobileWrap" class="hidden absolute inset-0">
            <div class="w-full h-full bg-gray-900 flex items-center justify-center">
              <div class="border border-gray-700 p-4 shadow-2xl">
                <iframe src="<%= landing_show_path(@project.slug) %>"
                        class="overflow-hidden"
                        style="width: 393px; height: 760px;"></iframe>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>
  </div>

<% elsif active_tab == "overview" %>
  <div class="max-w-6xl mx-auto px-4 py-8">
    <div class="bg-white border border-gray-200 p-5">
      <h2 class="font-semibold text-gray-900 mb-3"><i class="bi bi-graph-up-arrow text-gray-500 me-2"></i> Overview</h2>
      <p class="text-sm text-gray-600">
        Public page:
        <%= link_to @project.public_url, @project.public_url,
                    class: "text-emerald-700 hover:underline",
                    target: "_blank", rel: "noopener" %>
      </p>
      <div class="mt-6 text-sm text-gray-500">
        Coming soon.
      </div>
    </div>
  </div>

<% else %> <%# Leads %>
  <div class="max-w-6xl mx-auto px-4 py-8">
    <div class="bg-white border border-gray-200 p-5">
      <h2 class="font-semibold text-gray-900 mb-3"><i class="bi bi-people text-gray-500 me-2"></i> Leads</h2>
      <div class="mt-6 text-sm text-gray-500">
        Coming soon.
      </div>
    </div>
  </div>
<% end %>
