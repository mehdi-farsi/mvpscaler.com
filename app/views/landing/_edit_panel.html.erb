<%# locals: project:, landing:, template: %>
<div class="mt-4" data-controller="autosave-form">
  <div id="save_notice"></div>

  <%= form_with url: project_landing_path(project),
                method: :patch,
                data: { turbo_frame: "project_panel" },
                class: "space-y-10" do %>

    <% template.sections.each do |section| %>
      <section>
        <header class="flex items-end justify-between">
          <div>
            <h3 class="text-sm font-semibold text-gray-900"><%= section[:title] %></h3>
            <% if section[:subtitle].present? %>
              <p class="text-xs text-gray-500 mt-0.5"><%= section[:subtitle] %></p>
            <% end %>
          </div>
        </header>

        <!-- Settings list: label (min-w) + input -->
        <div class="mt-4 divide-y divide-gray-200 border border-gray-200 rounded-xl bg-white/80">
          <% section[:field_keys].each do |field_key| %>
            <div class="grid grid-cols-1 sm:grid-cols-5 gap-3 p-3 sm:p-3.5">
              <div class="sm:col-span-2">
                <% meta = (template.fields[field_key] || {}).stringify_keys %>
                <div class="text-[13px] font-medium text-gray-700">
                  <%= meta["label"].presence || field_key.split(".").last.humanize %>
                </div>
                <% if meta["hint"].present? %>
                  <div class="text-xs text-gray-500 mt-0.5"><%= meta["hint"] %></div>
                <% end %>
              </div>

              <div class="sm:col-span-3">
                <%= render "landing/field_input",
                           field_key: field_key,
                           template:  template,
                           landing:   landing %>
              </div>
            </div>
          <% end %>
        </div>
      </section>
    <% end %>

    <div class="flex items-center justify-end gap-3">
      <button type="submit"
              class="inline-flex items-center gap-2 rounded-md bg-emerald-600 px-3.5 py-2 text-sm font-semibold text-white
                     hover:bg-emerald-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-emerald-500">
        <i class="bi bi-check2-circle"></i>
        Save
      </button>
      <span class="text-xs text-gray-500">Preview updates instantly.</span>
    </div>
  <% end %>
</div>